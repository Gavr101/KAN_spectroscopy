# Общее описание 
В данном проекте представлен программный код по применению сетей Колмогорова-Арнольда (КАН) к обратной задачи спектроскопии, описанной в статье "..." (http://dx.doi.org/).

Постановка обратной задачи: по спектру флуорисценции определить концентрацию ионов металлов в растворе.

Спектр представлялся в сжатом (5 входных значений) и полном представлениях (500 входных значений).

![pic1](/Pictures/Pic1.png)
*Слева: двумерная матрица возбуждения-эмиссии водной суспензии CD в присутствии ионов тяжелых металлов. 
Справа – одномерный спектр флуоресценции при возбуждении 350 нм и его параметризация с помощью 5 параметров.*

В качестве моделей машинного обучения были взяты сети Колмогорова-Арнольда (KAN), случайные леса (RF), градиентный бустинг (GB) и персептрон с одним скрытым слоем (MLP).
Результаты приведены в барплотах:

![pic2](/Pictures/Pic2.png)
*Средняя абсолютная погрешность определения концентраций ионов четырьмя методами, основанными на сжатом представлении (слева) и на полном представлении спектра (справа).*

По предсказательной способности КАН показал себя не хуже референсных методов, а в некоторых случаях даже лучше.
При этом количество обучаемых параметров в КАН на порядок меньше, чем в использовавшейся модели персептрона.

| Количество обучаемых параметров | MLP | KAN |
|---------------------------------| ----|-----|
| Сжатый спектр (5 входных значений) | 449 | 48 |
| Полный спектр (500 входных значений) | 32 129 | 4008 |

## Визуальный пример обучения КАН *(со сжатыми спектрами на входе*).

### *1. Обучение КАН с B-сплайнами в качестве функций активации.*

![gif1](/Pictures/gif1.gif)

### *2. Аппроксимация функций активации КАН выбранным нами набором аналитических функций. Дообучение.*

![gif2](/Pictures/gif2.gif)

### *3. Визуальное и формульное представление модели КАН после обучения.*

![pic3](/Pictures/pic3.png)

![pic4](/Pictures/pic4.png)

---
# Описание предназначения файлов этого проекта
Реализация не использует сторонних пакетов. 
Иерархия директорий: 

0) Вспомогательный код:
    * json_config.txt - конфигурационный файл с гипперпараметрами моделей.
    * raw_data_processing.py - функции для загрузки карт флуорисценции.
    * tools.py - 
        1. функции для работы с файлами JSON; 
        2. функции для сжатия входных спектров;
        3. определение class KAN_es(KAN) - KAN с предварительной остановкой обучения по валидационному набору.

1) Код, демонстрирующий работу нескольких этапов проекта:
    * Full_input.ipynb - Обучение персептрона и КАН на полных спектрах на входе (500 значений).
    * Squeezed_input.ipynb - Сжатие (параметризация) входных спектров до 5 значений. Обучение персептрона и КАН на сжатых спектрах.
    * Mult_exper.ipynb - пример множественного запуска моделей RF, GB, MLP и KAN для определения одного иона металла с набором статистики.

2) Запуск кода из Mult_exper.ipynb к разным ионам.
    * Mult_exper_Cr.ipynb
    * Mult_exper_Cu.ipynb
    * Mult_exper_Ni.ipynb
    * Mult_exper_NO3.ipynb
---